"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),SPEECH_START_CONTEXT_TITLE="%s를 일본어로 읽기",SPEECH_STOP_CONTEXT_TITLE="일본어로 그만읽기",CONVERT_CONTEXT_TITLE="%s를 일본어로 변환",CONTEXT_TYPES=["selection","editable"],JKService=function(){function t(t){this.contextMenu=t}return t.prototype.getContext=function(){return null},t.prototype.onCreate=function(){this.contextMenu.create(this.getContext())},t.prototype.onUpdate=function(t){this.contextMenu.update(t,this.getContext())},t.prototype.getConsonantIndexAtKr=function(e){var n=e.charCodeAt(0);if(n>=t.KR_WORD_CODE_FIRST&&n<=t.KR_WORD_CODE_LAST){var o=Math.floor((n-t.KR_WORD_CODE_FIRST)/28/21);return o>0&&o--,o>3&&o--,o>5&&o--,o>6&&o--,o>8&&o--,o}return null},t.prototype.getVowelIndexAtKr=function(e){var n=e.charCodeAt(0);return n>=t.KR_WORD_CODE_FIRST&&n<=t.KR_WORD_CODE_LAST?Math.floor((n-t.KR_WORD_CODE_FIRST)/28)%21:null},t.prototype.getBadchimIndexAtKr=function(e){var n=e.charCodeAt(0);return n>=t.KR_WORD_CODE_FIRST&&n<=t.KR_WORD_CODE_LAST?n=(n-t.KR_WORD_CODE_FIRST)%28:null},t.prototype.getHiraganaAtKr=function(e){var n=this;return e.split("").map(function(e){if(e){var o=n.getConsonantIndexAtKr(e),r=n.getVowelIndexAtKr(e);if(null!==o&&null!==r){var i=n.getBadchimIndexAtKr(e);return""+t.JP_WORD_TABLE[o][r]+(i?t.JP_BADCHIM_TABLE[i]:"")}return"-"===e?"ー":" "===e||","===e?"\\":"."===e?"。":e}return null}).join("")},t.JP_WORD_TABLE=[["が","げ","ぎゃ","ぎぇ","ご","げ","ぎょ","ぎぇ","ご","ごぁ","きぇ","ごぇ","ぎょ","ぐ","ぐぉ","ぐえ","ぐぃ","ぎゅ","ぐ","ぐい","ぎ"],["な","ね","にゃ","しぇ","の","ね","にょ","にぇ","の","のぁ","にぇ","のぇ","にょ","ぬ","ぬぉ","ぬえ","ぬぃ","にゅ","ぬ","ぬい","に"],["だ","で","ぢゃ","ぢぇ","ど","で","ぢょ","ぢぇ","ど","どぁ","ぢぇ","どぇ","ぢょ","づ","づぉ","づえ","づぃ","ぢゅ","づ","づい","ぢ"],["ら","れ","りゃ","ふぇ","ろ","れ","りょ","ふぇ","ろ","ろぁ","りぇ","ろぇ","りょ","る","るぉ","るえ","るぃ","りゅ","る","るい","り"],["ま","め","みゃ","みぇ","も","め","みょ","みぇ","も","もぁ","みぇ","もぇ","みょ","む","むぉ","むえ","むぃ","みゅ","む","むい","み"],["ば","べ","びゃ","びぇ","ぼ","べ","びょ","びぇ","ぼ","ぼぁ","びぇ","ぼぇ","びょ","ぶ","ぶぉ","ぶえ","ぶぃ","びゅ","ぶ","ぶい","び"],["さ","せ","しゃ","しぇ","そ","せ","しょ","しぇ","そ","そぁ","しぇ","そぇ","しょ","す","すぉ","すえ","すぃ","しゅ","す","すい","し"],["あ","え","や","いぇ","お","え","よ","いぇ","お","わ","おえ","おぃ","よ","う","うぉ","うえ","うぃ","ゆ","う","うい","い"],["じゃ","じぇ","じゃ","じぇ","じょ","じぇ","じょ","じぇ","じょ","じょあ","しぇ","じぇ","じょ","じゅ","じゅ","じゅえ","じゅい","じゅ","じゅ","じゅい","じ"],["ちゃ","ちぇ","ちゃ","ちぇ","ちょ","ちぇ","ちょ","ちゅえ","ちょ","ちょあ","ちぇ","ちぇ","ちょ","ちゅ","ちゅ","つえ","ちゅい","ちゅ","つ","ちゅい","ち"],["か","け","きゃ","きぇ","こ","け","きょ","きぇ","こ","こあ","きぇ","こぇ","きょ","く","くぉ","くえ","くぃ","きゅ","く","くい","き"],["た","て","ちゃ","ちぇ","と","て","ちょ","ちぇ","と","とあ","ちぇ","とい","ちょ","つ","つぉ","つえ","つぃ","ちゅ","つ","つい","ち"],["ぱ","ぺ","ぴゃ","ぴぇ","ぽ","ぺ","ぴょ","ぴぇ","ぽ","ぽあ","ぴぇ","ぴぇ","ぴょ","ぷ","ぷぉ","ぷえ","ぷぃ","ぴゅ","ぷ","ぷい","ぴ"],["は","へ","ひゃ","ひぇ","ほ","へ","ひょ","ひぇ","ほ","ほあ","ほえ","ほい","ひょ","ふ","ふぉ","ふえ","ふぃ","ひゅ","ふ","ふい","ひ"]],t.JP_BADCHIM_TABLE=[null,"ぐ","ぐ","ぐ","ん","ん","ん","っ","る","ぐ","ん","ぶ","る","っ","ぶ","る","ん","ぶ","ぶ","っ","っ","ん","っ","っ","く","っ","っ","ぷ"],t.KR_WORD_CODE_FIRST="가".charCodeAt(0),t.KR_WORD_CODE_LAST="힣".charCodeAt(0),t}(),SpeechService=function(t){function e(e,n){var o=t.call(this,e)||this;return o.status=!1,o.status=!1,o.tts=n,o}return __extends(e,t),e.create=function(t,n){return new e(t,n)},e.prototype.getContext=function(){return this.status?{title:SPEECH_STOP_CONTEXT_TITLE,contexts:CONTEXT_TYPES,onclick:this.stop.bind(this)}:{title:SPEECH_START_CONTEXT_TITLE,contexts:CONTEXT_TYPES,onclick:this.start.bind(this)}},e.prototype.start=function(t,e){this.status=!0;var n=this.getHiraganaAtKr(t.selectionText);this.tts.speak(n,{lang:"ja-JP",rate:1,onEvent:this.createSpeechListener(t.menuItemId).bind(this)})},e.prototype.stop=function(t,e){this.tts.stop(),this.status=!1,this.onUpdate(t.menuItemId)},e.prototype.createSpeechListener=function(t){var e=this;return function(n){switch(n.type){case"word":e.status=!0,e.onUpdate(t);break;case"end":e.status=!1,e.onUpdate(t)}}},e}(JKService),ConvertService=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.create=function(t){return new e(t)},e.prototype.getContext=function(){return{title:CONVERT_CONTEXT_TITLE,contexts:CONTEXT_TYPES,onclick:this.translate.bind(this)}},e.prototype.translate=function(t,e){var n=this.getHiraganaAtKr(t.selectionText);t.editable&&chrome.tabs.executeScript({code:"var selection = window.getSelection();\nconsole.log(selection);\nif (selection.anchorNode.childNodes.length > 0) {\n    for (var i = 0; i < selection.anchorNode.childNodes.length; i++) {\n        var node = selection.anchorNode.childNodes[i];\n        if (node.value &&\n            (\n                node.type === 'text' ||\n                node.type === 'textarea' ||\n                node.type === 'search' ||\n                node.type === 'email'\n            )) {\n            if (node.value) {\n                node.value = \""+n+'";\n            }\n            if (node.nodeValue) {\n                node.nodeValue = "'+n+'";\n            }\n        }\n    }\n} else {\n    selection.anchorNode.nodeValue = "'+n+'";\n    selection.anchorNode.textContent = "'+n+'";\n}\n'})},e}(JKService),speechService=SpeechService.create(chrome.contextMenus,chrome.tts),convertService=ConvertService.create(chrome.contextMenus);speechService.onCreate(),convertService.onCreate();